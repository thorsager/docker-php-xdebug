#!/usr/bin/env bash
set -e

function convert {
  VAR=$(echo $1 | cut -d '=' -f1)
  VAL=$(echo $1 | cut -d '=' -f2)
  VAR=${VAR##XDEBUG_}
  VAR=${VAR,,}
  echo "xdebug.${VAR}=${VAL}" >> $2
}

function setup {
  echo "# Generated by docker-xdebug-create-ini" > $1
  echo "zend_extension=$(find /usr/local/lib/php/extensions/ -name xdebug.so)" >> $1
}

for v in $(env); do
  # echo $v
  case $v in
    XDEBUG_*)
      [ -z ${FIRST} ] && setup "$1" && FIRST=NOMORE
      convert "$v" "$1"
    ;;
  esac
done
